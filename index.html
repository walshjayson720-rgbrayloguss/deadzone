<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Deadwave</title>
<style>
body {
  margin:0;
  background:#111;
  overflow:hidden;
  font-family: Arial, sans-serif;
}
canvas { display:none; }

/* LOADING SCREEN */
#loading {
  position:fixed;
  inset:0;
  background:#111;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:white;
  z-index:10;
}

#title {
  font-size:64px;
  font-weight:bold;
  margin-bottom:30px;
}

#bar {
  width:300px;
  height:20px;
  border:2px solid white;
}
#fill {
  width:0%;
  height:100%;
  background:lime;
}

#tip {
  margin-top:20px;
  opacity:.7;
}

/* GAME UI */
#shop {
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  color:white;
  display:none;
  text-align:center;
  padding-top:100px;
}
button { padding:10px 20px; margin:8px; font-size:16px; }
</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loading">
  <div id="title">DEADWAVE</div>
  <div id="bar"><div id="fill"></div></div>
  <div id="tip">Survive the waves.</div>
</div>

<canvas id="game"></canvas>

<div id="shop">
  <h1>PERK SHOP</h1>
  <button onclick="perk('damage')">+1 Damage</button>
  <button onclick="perk('regen')">Faster Regen</button>
  <button onclick="perk('firerate')">Faster Fire Rate</button>
  <br><br>
  <button onclick="nextWave()">Next Wave</button>
</div>

<script>
/* ---------- LOADING ---------- */
let progress = 0;
const fill = document.getElementById("fill");
const loading = document.getElementById("loading");
const canvas = document.getElementById("game");

const loader = setInterval(() => {
  progress += Math.random() * 10;
  if (progress >= 100) {
    progress = 100;
    clearInterval(loader);
    loading.style.opacity = "0";
    setTimeout(() => {
      loading.style.display = "none";
      canvas.style.display = "block";
      startGame();
    }, 500);
  }
  fill.style.width = progress + "%";
}, 200);

/* ---------- GAME ---------- */
function startGame() {
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const player = {
  x: canvas.width/2,
  y: canvas.height/2,
  r: 18,
  health: 100,
  maxHealth: 100,
  speed: 4,
  lastHit: 0
};

let bullets=[], zombies=[], keys={}, mouse={x:0,y:0};
let wave=1, kills=0, damage=1, regenBonus=0;
let shootCooldown=500, lastShot=0, inShop=false;

addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);
addEventListener("mousemove",e=>{mouse.x=e.clientX;mouse.y=e.clientY});
addEventListener("mousedown",shoot);

function shoot(){
  if(inShop || Date.now()-lastShot<shootCooldown) return;
  lastShot=Date.now();
  const a=Math.atan2(mouse.y-player.y,mouse.x-player.x);
  bullets.push({x:player.x,y:player.y,dx:Math.cos(a)*10,dy:Math.sin(a)*10});
}

function spawnZombie(type){
  let z={x:Math.random()*canvas.width,y:Math.random()*canvas.height};
  if(type==="fast"){z.r=15;z.speed=3;z.health=2;}
  else if(type==="tank"){z.r=28;z.speed=1;z.health=6+wave;}
  else if(type==="boss"){z.r=40;z.speed=1+wave*.05;z.health=15+wave*2;z.boss=true;}
  else {z.r=20;z.speed=1.5;z.health=3;}
  z.maxHealth=z.health;
  zombies.push(z);
}

function spawnWave(){
  zombies=[];
  for(let i=0;i<wave*2;i++){
    spawnZombie(Math.random()<.2?"fast":Math.random()<.3?"tank":"normal");
  }
  if(wave%10===0) spawnZombie("boss");
}

function perk(p){
  if(p==="damage") damage++;
  if(p==="regen") regenBonus+=0.05;
  if(p==="firerate" && shootCooldown>200) shootCooldown-=50;
}

function nextWave(){
  inShop=false;
  document.getElementById("shop").style.display="none";
  wave++;
  spawnWave();
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(keys.w) player.y-=player.speed;
  if(keys.s) player.y+=player.speed;
  if(keys.a) player.x-=player.speed;
  if(keys.d) player.x+=player.speed;

  ctx.fillStyle="#d2b48c";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();

  const a=Math.atan2(mouse.y-player.y,mouse.x-player.x);
  ctx.strokeStyle="#000";
  ctx.lineWidth=5;
  ctx.beginPath();
  ctx.moveTo(player.x,player.y);
  ctx.lineTo(player.x+Math.cos(a)*30,player.y+Math.sin(a)*30);
  ctx.stroke();

  bullets.forEach((b,i)=>{
    b.x+=b.dx; b.y+=b.dy;
    ctx.fillStyle="#fff";
    ctx.fillRect(b.x,b.y,4,4);
    zombies.forEach((z,zi)=>{
      if(Math.hypot(b.x-z.x,b.y-z.y)<z.r){
        z.health-=damage;
        bullets.splice(i,1);
        if(z.health<=0){ zombies.splice(zi,1); kills++; }
      }
    });
  });

  zombies.forEach(z=>{
    const a=Math.atan2(player.y-z.y,player.x-z.x);
    z.x+=Math.cos(a)*z.speed;
    z.y+=Math.sin(a)*z.speed;

    if(Math.hypot(player.x-z.x,player.y-z.y)<player.r+z.r){
      if(Date.now()-player.lastHit>800){
        player.health-=10;
        player.lastHit=Date.now();
      }
    }

    ctx.fillStyle=z.boss?"#8b0000":"#228b22";
    ctx.beginPath();
    ctx.arc(z.x,z.y,z.r,0,Math.PI*2);
    ctx.fill();
  });

  if(Date.now()-player.lastHit>3000 && player.health<player.maxHealth){
    player.health+=0.1+regenBonus;
  }

  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Wave: "+wave,canvas.width-120,30);
  ctx.fillText("Kills: "+kills,20,30);

  if(zombies.length===0 && !inShop){
    inShop=true;
    document.getElementById("shop").style.display="block";
  }

  requestAnimationFrame(update);
}

spawnWave();
update();
}
</script>
</body>
</html>
