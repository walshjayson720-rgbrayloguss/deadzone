<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Deadwave</title>
<style>
body {
  margin:0;
  overflow:hidden;
  background:#111;
  color:white;
  font-family:Arial, sans-serif;
}

canvas {
  display:block;
  margin:auto;
  background:#1a1a1a;
}

/* HUD */
#hud {
  position:fixed;
  top:10px;
  left:10px;
  font-size:16px;
}

#healthBar {
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  width:300px;
  height:20px;
  border:2px solid white;
}

#healthFill {
  height:100%;
  width:100%;
  background:red;
}

/* SHOP */
#shop {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  text-align:center;
}

.perks {
  display:flex;
  justify-content:center;
  gap:30px;
  margin-top:60px;
}

.perk {
  position:relative;
  width:220px;
  height:260px;
  border:6px solid black;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  transition:.15s;
}

.perk:hover { transform:translateY(-6px); }

.strength { background:#c96a1b; }
.firerate { background:#1b5fc9; }
.regen { background:#c91b1b; }

.perk.selected {
  outline:5px solid yellow;
  box-shadow:0 0 30px yellow;
}

.icon { font-size:48px; margin-bottom:15px; }
.perk-text { font-size:18px; }

.stack {
  position:absolute;
  top:10px;
  right:10px;
  background:black;
  color:yellow;
  padding:4px 8px;
  display:none;
}

.perk::after {
  content: attr(data-desc);
  position:absolute;
  bottom:-45px;
  left:50%;
  transform:translateX(-50%);
  background:black;
  padding:6px 10px;
  font-size:14px;
  opacity:0;
  transition:.15s;
  white-space:nowrap;
}

.perk:hover::after { opacity:1; }

.menu-btn {
  margin-top:40px;
  padding:10px 25px;
  font-size:18px;
}
</style>
</head>

<body>
<canvas id="game" width="900" height="600"></canvas>

<div id="hud">
  Wave: <span id="wave">1</span><br>
  Kills: <span id="kills">0</span>
</div>

<div id="healthBar"><div id="healthFill"></div></div>

<div id="shop">
  <h2>CHOOSE A PERK</h2>
  <div class="perks">
    <div class="perk strength" onclick="selectPerk(this,'damage')" data-desc="+1 damage per stack">
      <div class="icon">üí™</div>
      <div class="perk-text">STRENGTH</div>
      <div class="stack" id="stack-damage"></div>
    </div>
    <div class="perk firerate" onclick="selectPerk(this,'firerate')" data-desc="Shoot faster">
      <div class="icon">üî´</div>
      <div class="perk-text">FIRE RATE</div>
      <div class="stack" id="stack-firerate"></div>
    </div>
    <div class="perk regen" onclick="selectPerk(this,'regen')" data-desc="Faster health regen">
      <div class="icon">‚ù§Ô∏è</div>
      <div class="perk-text">REGEN</div>
      <div class="stack" id="stack-regen"></div>
    </div>
  </div>
  <button class="menu-btn" id="continueBtn" onclick="applyPerk()" disabled>Continue</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let player = { x:450, y:300, r:15, hp:100, maxHp:100 };
let bullets = [];
let zombies = [];
let wave = 1;
let kills = 0;
let lastShot = 0;
let shootCooldown = 500;
let damage = 1;
let regenBonus = 0;
let lastHit = 0;
let inShop = false;
let selectedPerk = null;

let perkStacks = { damage:0, firerate:0, regen:0 };

const mouse = { x:0, y:0 };

canvas.addEventListener("mousemove", e => {
  const r = canvas.getBoundingClientRect();
  mouse.x = e.clientX - r.left;
  mouse.y = e.clientY - r.top;
});

canvas.addEventListener("mousedown", () => {
  if (Date.now() - lastShot > shootCooldown && !inShop) {
    lastShot = Date.now();
    bullets.push({
      x:player.x,
      y:player.y,
      dx:(mouse.x-player.x)/10,
      dy:(mouse.y-player.y)/10
    });
  }
});

function spawnWave() {
  zombies=[];
  const count = wave*3;
  const boss = wave % 10 === 0;

  for(let i=0;i<count;i++){
    zombies.push({
      x:Math.random()*900,
      y:Math.random()*600,
      hp: boss ? 150 : 30,
      max: boss ? 150 : 30,
      speed: boss ? 0.6 : 1
    });
  }
}

function update() {
  ctx.clearRect(0,0,900,600);

  if(Date.now()-lastHit>3000 && player.hp<player.maxHp){
    player.hp += 0.05 + regenBonus;
  }

  bullets.forEach(b=>{
    b.x+=b.dx; b.y+=b.dy;
    ctx.fillStyle="yellow";
    ctx.fillRect(b.x,b.y,4,4);
  });

  zombies.forEach(z=>{
    const dx=player.x-z.x, dy=player.y-z.y;
    const d=Math.hypot(dx,dy);
    z.x+=dx/d*z.speed;
    z.y+=dy/d*z.speed;

    if(d<20){
      player.hp-=10;
      lastHit=Date.now();
    }

    ctx.fillStyle="green";
    ctx.beginPath();
    ctx.arc(z.x,z.y,15,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle="red";
    ctx.fillRect(z.x-15,z.y-20,30*(z.hp/z.max),4);
  });

  bullets.forEach((b,bi)=>{
    zombies.forEach((z,zi)=>{
      if(Math.hypot(b.x-z.x,b.y-z.y)<15){
        z.hp-=damage;
        bullets.splice(bi,1);
        if(z.hp<=0){
          zombies.splice(zi,1);
          kills++;
        }
      }
    });
  });

  ctx.fillStyle="tan";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();

  document.getElementById("healthFill").style.width =
    (player.hp/player.maxHp*100)+"%";
  document.getElementById("wave").textContent = wave;
  document.getElementById("kills").textContent = kills;

  if(zombies.length===0 && !inShop){
    inShop=true;
    document.getElementById("shop").style.display="block";
  }

  requestAnimationFrame(update);
}

function selectPerk(el,p){
  document.querySelectorAll(".perk").forEach(x=>x.classList.remove("selected"));
  el.classList.add("selected");
  selectedPerk=p;
  document.getElementById("continueBtn").disabled=false;
}

function applyPerk(){
  perkStacks[selectedPerk]++;
  if(selectedPerk==="damage") damage++;
  if(selectedPerk==="regen") regenBonus+=0.05;
  if(selectedPerk==="firerate" && shootCooldown>150) shootCooldown-=50;
  updateStacks();
  selectedPerk=null;
  inShop=false;
  document.getElementById("shop").style.display="none";
  document.getElementById("continueBtn").disabled=true;
  wave++;
  spawnWave();
}

function updateStacks(){
  for(let p in perkStacks){
    const el=document.getElementById("stack-"+p);
    if(perkStacks[p]>0){
      el.textContent="x"+perkStacks[p];
      el.style.display="block";
    }
  }
}

spawnWave();
update();
</script>
</body>
</html>
