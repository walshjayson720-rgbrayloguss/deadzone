<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Zombie Shooter</title>
<style>
body { margin:0; background:#111; overflow:hidden; }
canvas { display:block; }
#shop {
  position:absolute; inset:0;
  background:rgba(0,0,0,.85);
  color:white;
  display:none;
  text-align:center;
  padding-top:100px;
}
button { padding:10px 20px; margin:8px; font-size:16px; }
#fullscreen {
  position:absolute; bottom:10px; right:10px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="shop">
  <h1>PERK SHOP (Choose One)</h1>
  <button onclick="perk('damage')">+1 Damage</button>
  <button onclick="perk('regen')">Faster Regen</button>
  <button onclick="perk('firerate')">Faster Fire Rate</button>
  <br><br>
  <button onclick="nextWave()">Next Wave</button>
</div>

<button id="fullscreen" onclick="toggleFS()">Fullscreen</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let save = JSON.parse(localStorage.getItem("zombieSave")) || {};

const player = {
  x: canvas.width/2,
  y: canvas.height/2,
  r: 18,
  health: 100,
  maxHealth: 100,
  speed: 4,
  lastHit: 0
};

let bullets=[], zombies=[], keys={}, mouse={x:0,y:0};
let wave = save.wave || 1;
let kills = save.kills || 0;
let damage = save.damage || 1;
let shootCooldown = save.cooldown || 500;
let regenBonus = save.regen || 0;
let lastShot=0;
let inShop=false;

addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);
addEventListener("mousemove",e=>{mouse.x=e.clientX;mouse.y=e.clientY});
addEventListener("mousedown",shoot);

function shoot(){
  if(inShop || Date.now()-lastShot<shootCooldown) return;
  lastShot=Date.now();
  const a=Math.atan2(mouse.y-player.y,mouse.x-player.x);
  bullets.push({x:player.x,y:player.y,dx:Math.cos(a)*10,dy:Math.sin(a)*10});
}

function spawnZombie(type){
  let z={x:Math.random()*canvas.width,y:Math.random()*canvas.height};
  if(type==="fast"){ z.r=15; z.speed=3+wave*.05; z.health=2; }
  else if(type==="tank"){ z.r=28; z.speed=1; z.health=6+wave; }
  else if(type==="boss"){ z.r=40; z.speed=1+wave*.05; z.health=15+wave*2; z.boss=true; }
  else { z.r=20; z.speed=1.5+wave*.03; z.health=3; }
  z.maxHealth=z.health;
  zombies.push(z);
}

function spawnWave(){
  zombies=[];
  for(let i=0;i<wave*2;i++){
    const r=Math.random();
    spawnZombie(r<.2?"fast":r<.35?"tank":"normal");
  }
  if(wave%10===0) spawnZombie("boss");
}

function perk(p){
  if(p==="damage") damage++;
  if(p==="regen") regenBonus+=0.05;
  if(p==="firerate" && shootCooldown>200) shootCooldown-=50;
  saveGame();
}

function nextWave(){
  inShop=false;
  document.getElementById("shop").style.display="none";
  wave++;
  spawnWave();
  saveGame();
}

function saveGame(){
  localStorage.setItem("zombieSave",JSON.stringify({
    wave,kills,damage,cooldown:shootCooldown,regen:regenBonus
  }));
}

function toggleFS(){
  if(!document.fullscreenElement) document.body.requestFullscreen();
  else document.exitFullscreen();
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(keys.w) player.y-=player.speed;
  if(keys.s) player.y+=player.speed;
  if(keys.a) player.x-=player.speed;
  if(keys.d) player.x+=player.speed;

  // player
  ctx.fillStyle="#d2b48c";
  ctx.beginPath(); ctx.arc(player.x,player.y,player.r,0,Math.PI*2); ctx.fill();

  // gun
  const a=Math.atan2(mouse.y-player.y,mouse.x-player.x);
  ctx.strokeStyle="#000"; ctx.lineWidth=5;
  ctx.beginPath();
  ctx.moveTo(player.x,player.y);
  ctx.lineTo(player.x+Math.cos(a)*30,player.y+Math.sin(a)*30);
  ctx.stroke();

  bullets.forEach((b,i)=>{
    b.x+=b.dx; b.y+=b.dy;
    ctx.fillStyle="#fff"; ctx.fillRect(b.x,b.y,4,4);
    zombies.forEach((z,zi)=>{
      if(Math.hypot(b.x-z.x,b.y-z.y)<z.r){
        z.health-=damage;
        bullets.splice(i,1);
        if(z.health<=0){
          zombies.splice(zi,1);
          kills++;
          if(z.boss) for(let m=0;m<5;m++) spawnZombie("fast");
        }
      }
    });
  });

  zombies.forEach(z=>{
    const a=Math.atan2(player.y-z.y,player.x-z.x);
    z.x+=Math.cos(a)*z.speed;
    z.y+=Math.sin(a)*z.speed;

    if(Math.hypot(player.x-z.x,player.y-z.y)<player.r+z.r){
      if(Date.now()-player.lastHit>800){
        player.health-=10;
        player.lastHit=Date.now();
      }
    }

    ctx.fillStyle=z.boss?"#8b0000":z.r<18?"#00ff00":"#228b22";
    ctx.beginPath(); ctx.arc(z.x,z.y,z.r,0,Math.PI*2); ctx.fill();

    ctx.fillStyle="red";
    ctx.fillRect(z.x-20,z.y-z.r-10,40,5);
    ctx.fillStyle="lime";
    ctx.fillRect(z.x-20,z.y-z.r-10,40*(z.health/z.maxHealth),5);
  });

  if(Date.now()-player.lastHit>3000 && player.health<player.maxHealth){
    player.health+=0.1+regenBonus;
  }

  ctx.fillStyle="white"; ctx.font="20px Arial";
  ctx.fillText("Wave: "+wave, canvas.width-120,30);
  ctx.fillText("Kills: "+kills,20,30);

  ctx.fillStyle="red";
  ctx.fillRect(canvas.width/2-100,canvas.height-40,200,15);
  ctx.fillStyle="lime";
  ctx.fillRect(canvas.width/2-100,canvas.height-40,200*(player.health/player.maxHealth),15);

  if(zombies.length===0 && !inShop){
    inShop=true;
    document.getElementById("shop").style.display="block";
  }

  requestAnimationFrame(update);
}

spawnWave();
update();
</script>
</body>
</html>
